---
title: "IMDB Predictions"
author: "Peters"
date: "8/31/2020"
output: html_document
---

Data avaiable through kaggle at: https://www.kaggle.com/c/imdb495

Objective: Determine a model that will help us predict imdb scores.

```{r setup, include=FALSE}
library("tidyverse")
```

```{r}
test <- read.csv("imdb495/IMDBTest.csv")
train <- read.csv("imdb495/IMDBTrain.csv")
ex <- read.csv("imdb495/exchange_rates.csv")


#we want to merge our test and training so that when we do out imputations are consistent
names(test)[names(test) == "Id"] <- "movie_title"
(imdb <- bind_rows(train = train, test = test, .id="Set"))
```

Summarize data

```{r}
summary(train)
```

Regression Imputation - Filling in missing values with the regression predicted values

```{r}
sum(is.na(train$plot_keywords))

#Finds top keywords in dataframe
keywordDF <- as.data.frame((train$plot_keywords %>% sapply(function(x) unlist(str_split(x, "[\\| ]"))) %>% unlist %>% unname %>% table %>% sort.int(decreasing = TRUE)))

#REmoves common words and takes top 100 words
keywordDF <- keywordDF[-which(keywordDF$. %in% stopwords::stopwords("en")), ] %>% head(100)

#########################################################################
#finds frequency of top key words per row

#creates empty list
sumList = rep(0, length(keywordDF))

#retreaves list of every keyword by row
temp <- train$plot_keywords %>% sapply(function(x) unlist(str_split(x, "[\\| ]"))) %>% unname

#compares every row and counts number of top key words in that row
for (i in 1:length(temp)){
  sumList[i] <- sum(unique(temp[[i]]) %in% keywordDF$.)
}

#sets list into dataframe
train$num_Key_words <- sumList

train$keyword_cat <- ifelse(train$num_Key_words < 2, "Low", "Medium")
train$keyword_cat <- ifelse(train$num_Key_words >= 4,"high", train$keyword_cat)

sum(is.na(train$num_Key_words))
sum(is.na(train$keyword_cat))


#####################################################################
# if we want dummy variables of top 100 words...

tempDF <- train$plot_keywords %>% sapply(function(x) unlist(str_split(x, "[\\| ]"))) %>% qdapTools::mtabulate()

tempDF[, colnames(tempDF) %in% keywordDF$. ]
```

```{r}
boxplot(train$imdb_score~train$keyword_cat)

hist(train$num_Key_words)

ggplot(data=train, mapping=aes(x=num_Key_words, y=imdb_score)) +
  geom_point()
```


```{r}
colnames(train$genres %>% sapply(function(x) unlist(str_split(x, "\\|"))) %>% qdapTools::mtabulate())

train$genres %>% sapply(function(x) unlist(str_split(x, "\\|"))) %>% qdapTools::mtabulate()





```




```{r}
pairs(~imdb_score+num_critic_for_reviews+duration+gross+num_voted_users+num_user_for_reviews+budget+title_year+aspect_ratio, data = train)
```


For Class on Friday

```{r}
train$facenumber_in_poster[is.na(train$facenumber_in_poster)] <- mean(train$facenumber_in_poster, na.rm = TRUE) #Replace posters with mean

print("missing keywords: ")
sum(is.na(train$plot_keywords)) #Sum of missing keywords, probably shou;d just drop?

print("missing links: ")
sum(is.na(train$movie_imdb_link)) #Sum of missing links, probably should just drop?

train$num_user_for_reviews[is.na(train$num_user_for_reviews)] <- median(train$facenumber_in_poster, na.rm = TRUE) #number of users

train$language[is.na(train$language)] <-"English" #Replace language with english, most of the countries were USA, or english movies if country was NA

train$country[is.na(train$country)] <-"USA" #Only 4 NA, either remove them or replace with USA

train[is.na(train$content_rating),]  #Maybe this would be a good one to  use KNN or K-means? 274 missing values


#Converting our currency to 2020 USD
tempDF <- train %>%
  left_join(ex)

train$budget <- train$budget * tempDF$exchange_rate

train$budget[is.na(train$budget)] <-median(train$budget, na.rm = TRUE)
```

```{r}
ggplot(data=train, mapping=aes(x=gross, y=imdb_score)) +
  geom_point()


with(train, cor(gross, imdb_score, use="complete.obs"))
```







```{r}
ggplot(data=train, mapping=aes(x=log(num_user_for_reviews), y=imdb_score, color = content_rating)) +
  geom_point()
with(train, cor(gross, imdb_score, use="complete.obs"))
```




We notice some ridiculous budgets for our currency, so we will need to do some conversions.
```{r}
ggplot(data=train, mapping=aes(x=budget, y=imdb_score)) +
  geom_point()

train %>% filter(budget>4e8) %>% select(movie_title, country)
```


```{r}
ggplot(data=train, mapping=aes(x=budget, y=imdb_score)) +
  geom_point()

train %>% filter(budget>100000000, country=="USA") %>% select(movie_title, country)
```


We notice some ridiculous budgets for our currency, so we will need to do some conversions.
```{r}
ggplot(data=train, mapping=aes(x=budget, y=imdb_score)) +
  geom_point()

train %>% filter(budget>1e9) %>% select(movie_title, country)
```


```{r}
ggplot(data=train, mapping=aes(x=budget, y=imdb_score)) +
  geom_point()

train %>% filter(budget>100000000, country=="USA") %>% select(movie_title, country)
```

```{r}
rating <- train %>%
  group_by(content_rating) %>%
  summarize(score = mean(imdb_score), n=n()) %>%
  arrange(-score)

rating
barplot(rating$score, names.arg = rating$content_rating)
```


```{r}
train %>%
  group_by(color) %>%
  summarize(score = mean(imdb_score), n=n()) %>%
  arrange(-score)

```


<<<<<<< HEAD
plot(dir$score)
```

=======
>>>>>>> e6001fbb040dd9ccd793a5d6fb853dbb8f12a180
